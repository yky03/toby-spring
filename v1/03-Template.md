
>**템플릿**    

: **스프링에 적용된 템플릿 기법을 살펴보고, 이를 적용해 완성도 있는 DAO 코드를 만드는 방법을 알아보자.**  

2장에서는 DBConnection 에 대한 예제로 1장에서 다뤘던 아래의 디자인 패턴들로 try-catch-finally 패턴에서 close   
즉, 예외발생시 리소스를 제대로 반납하지 않아 커넥션풀 문제로 서버가 다운될 수 있는 상황에 대해 설명하고 있다.   

<br/>

>**디자인패턴 & 리팩토링**  

**-개방 폐쇄 원칙**   
: 확장에는 자유롭게 열려 있고 변경에는 굳게 닫혀 있다는 객체지향 설계의 핵심 원칙이다.  
<br/>
**-메소드 추출**  
: 변화되거나 공통되는 부분을 메소드로 빼서 가독성 및 재사용이 가능하도록 한다.  

**-템플릿 메소드 패턴 & 전략 패턴 example**  
: https://github.com/yky03/toby-spring/blob/main/v1/01-ObjectAndDependencyRelationship.md
<br/>

**-템플릿으로 효과적인 DI 적용을 위한 방법**   
: 클라이언트/컨텍스트를 분리하고 전략클래스, 로컬클래스, 익명 내부 클래스(람다로 사용 가능)를 활용하자.   

<br/>


>**Tip**  

: try catch 보다는 try with resource를 사용하라! -> [이펙티브 자바](https://sabarada.tistory.com/78)  


**[AS-IS]**   
-> [Bubble Style](https://soft.plusblog.co.kr/164)로 가독성 떨어짐.  
```java
finally {
    if(bufferedInputStream != null) {
        try {
            bufferedInputStream.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    try {
        if(fileInputStream == null) {
            fileInputStream.close();
        }
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```
**[TO-BE]**  
-> 복잡한 구문 없이 자원 반납 가능.   
```java
try (BufferedInputStream bufferedInputStream = new BufferedInputStream(new FileInputStream(file))){
    ...
} catch ( ) {
    ...
}
```


--------------------------- p.231 ---------------------------

**>템플릿 콜백 패턴

탬플릿 콜백 패턴(Template Callback Pattern)은 전략 패턴의 변형으로 **DI (Dependency injection) 의존성 주입**에서 사용하는 특별한 전략 패턴.  
탬플릿 콜백 패턴은 **전략 패턴에 익명 내부 클래스를 가미해서 사용하는 방법**  


-**템플릿** : 전략 패턴의 Context  
-**콜백** : 익명 내부 클래스로 구현된 오브젝트. 일반적으로 단일 메소드 '인터페이스'를 지닌다.  

>**Tip**  

->  Javascript에서는 함수가 일급 객체다. 따라서 콜백 함수를 별다른 문제없이 바로 구현할 수 있다. 콜백이 필요한 자리에 그냥 function을 던진다는 소리다.  
그런데 놀랍게도 자바는 함수를 파라미터로 전달할 수 없다고 한다. 그러면 당연히, function을 감싼 class를 전달해야 할 것이다.  

<br/>

-> [함수형 프로그래밍과 람다](https://dinfree.com/lecture/language/112_java_9.html)  

```
함수형 프로그래밍(FP)은 순수 함수(pure function)를 조합하고 공유 상태(shared state),   
변경 가능한 데이터(mutable data) 및 부작용(side-effects) 을 피하는 기본 원칙에 따라 소프트웨어를 구성하는 프로그래밍 패러다임.  

함수형 프로그래밍 조건
일반적으로 함수형 프로그래밍에서는 다음 세가지 조건을 만족시켜야 합니다.

1)순수 함수(pure function)
순수 함수란 같은 입력에 대해 항상 같은 출력을 반환하는 함수로 다음과 같은 조건을 만족하는 함수를 말합니다. 멀티쓰레드에서도 안전하고 병렬처리 및 계산도 가능합니다.

동일한 입력에 대해 항상 같은 값을 반환.
부작용(다른 요인에 따른 결과변경)이 없는 결과를 생성. -> 함수에서 인자를 변경하거나 프로그램의 상태를 변경하지 않음.

2)고차함수(High Order Function)
1급 함수의 서브셋으로 다음 조건을 만족하는 함수를 말합니다.

함수의 인자로 함수를 전달할 수 있다.
함수의 리턴값으로 함수를 사용할 수 있다.

3)익명 함수(Anonymous function)
이름이 없는 함수를 말하며 람다식으로 표현되는 함수 구현을 말합니다.

합성 함수(function composition)는 새로운 함수를 만들거나 계산하기 위해 둘 이상의 함수를 조합하는 것을 말하는 것으로 데이터가 흐르도록 일련의 파이프라인을 형성하는 개념 입니다. 함수형 프로그램은 작은 단위의 순수 함수들로 구성되어 있기 때문에 이 함수들을 연속적 혹은 병렬로 호출해서 더 큰 함수를 만드는 과정으로 프로그램이 구성되어야 합니다.

실제 구현상에는 메서드 체이닝 방식으로 함수들을 연결해 사용하는 형태로 나타 납니다.

-람다란 익명 함수형태로 사용

-함수형 인터페이스란 단일 추상 메서드를 가지는 인터페이스
```

**>3장 템플릿 정리**

-JDBC와 같은 예외가 발생할 가능성이 있으며 **공유 리소스의 반환이 필요한 코드는 반드시 try/catch/finally 블록으로 관리**해야 한다.  
-일정한 작업 흐름이 반복되면서 그중 일부 기능만 바뀌는 코드가 존재한다면 **전략 패턴을 적용**한다.  
바뀌지 않는 부분을 컨텍스트로, 바뀌는 부분은 전략으로 만들고 **인터페이스**를 통해 유연하게 전략을 변경할 수 있도록 구성한다.  
-클라이언트 메소드 안에 **익명 내부 클래스를 사용해서 전략 오브젝트를 구현**하면 코드도 간결해지고 메소드의 정보를 직접 사용할 수 있어서 편리하다.  
-컨텍스트가 하나 이상의 클라이언트 오브젝트에서 사용된다면 클래스를 **분리**해서 공유하도록 만든다.  
-단일 전략 메소드를 갖는 전략 패턴이면서 익명 내부 클래스를 사용해서 매번 전략을 새로 만들어 사용하고, **컨텍스트 호출과 동시에 전략 DI를 수행하는 방식을 템플릿/콜백 패턴**이라고 한다.  
-콜백의 코드에도 일정한 패천이 반복된다면 **콜백을 템플릿에 넣고 재활용**하는 것이 편리하다.  
-템플릿과 콜백의 타입이 다양하게 바뀔 수 있다면 **제네릭스**를 이용한다.  
-템플릿은 한 번에 하나 이상의 콜백을 사용할 수도 있고, 하나의 콜백을 여러 번 호출할 수도 있다.  
-템플릿/콜백을 설계할 때는 템플릿과 콜백 사이에 **주고받는 정보에 관심**을 둬야한다.  



**>References**  

[토비의스프링3장 템플릿 정리](https://velog.io/@roeniss/%ED%86%A0%EB%B9%84%EC%9D%98-%EC%8A%A4%ED%94%84%EB%A7%81-3.1-3%EC%9E%A5-%ED%85%9C%ED%94%8C%EB%A6%BF)  
[템플릿 콜백 패턴](https://limkydev.tistory.com/85)  
[디자인 패턴 종류](https://gmlwjd9405.github.io/2018/07/06/design-pattern.html)  
[템플릿 콜백 예제](https://empering.tistory.com/entry/%ED%86%A0%EB%B9%84%EC%9D%98-%EC%8A%A4%ED%94%84%EB%A7%81-Vol-1-%EC%A0%95%EB%A6%AC-3%EC%9E%A5-%ED%85%9C%ED%94%8C%EB%A6%BF-2)  
[함수형 프로그래밍과 람다](https://dinfree.com/lecture/language/112_java_9.html)  





